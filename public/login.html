<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex">
  <title>Login - CampusVibe</title>
  <link rel="stylesheet" href="/assets/css/styles.css" />
  <link rel="canonical" href="/login.html">
  <meta name="theme-color" content="#6c88ff">
  <script src="/assets/js/lottie.min.js"></script>
</head>
<body>
  <header class="cv-header">
    <div class="container header-inner">
      <a href="/" class="brand" style="text-decoration:none;color:inherit">
        <img src="/assets/img/logo.svg" class="logo" alt="CampusVibe" />
        <div class="brand-text">
          <h1>CampusVibe</h1>
          <p class="tagline">Ideal Management, Ideal Moments</p>
        </div>
      </a>
      <a href="/" class="btn" style="text-decoration:none;color:inherit">Home</a>
    </div>
  </header>

  <main class="container" style="padding:0;">
    <style>
      .auth-wrap { position: relative; min-height: calc(100vh - 64px); display: grid; place-items: center; padding: 40px 16px; }
      .anim-bg { position: fixed; inset: 0; z-index: -1; background:
        radial-gradient(1000px 500px at 10% 10%, rgba(108,140,255,0.18), transparent 60%),
        radial-gradient(900px 450px at 90% 0%, rgba(0,209,178,0.14), transparent 60%),
        linear-gradient(180deg, #0b1021 0%, #0e1738 100%);
        animation: bgShift 18s ease-in-out infinite alternate; }
      @keyframes bgShift { from { filter: hue-rotate(0deg) saturate(1); } to { filter: hue-rotate(20deg) saturate(1.1); } }
      .orb { position: absolute; width: 320px; height: 320px; border-radius: 50%; filter: blur(18px); mix-blend-mode: screen; opacity: .5; }
      .o1 { top: 6%; left: 4%; background: radial-gradient(circle at 30% 30%, rgba(108,140,255,.55), transparent 60%); animation: floatY 10s ease-in-out infinite; }
      .o2 { bottom: 8%; left: 15%; background: radial-gradient(circle at 40% 40%, rgba(0,209,178,.45), transparent 60%); animation: floatX 13s ease-in-out infinite; }
      .o3 { top: 15%; right: 12%; background: radial-gradient(circle at 50% 50%, rgba(140,82,255,.45), transparent 60%); animation: floatY 11s ease-in-out infinite .5s; }
      .o4 { bottom: 12%; right: 6%; background: radial-gradient(circle at 60% 60%, rgba(255,111,145,.40), transparent 60%); animation: floatX 12s ease-in-out infinite .2s; }
      @keyframes floatY { 0%, 100% { transform: translateY(-8px); } 50% { transform: translateY(8px); } }
      @keyframes floatX { 0%, 100% { transform: translateX(-10px); } 50% { transform: translateX(10px); } }
      .auth-card { width: 100%; max-width: 540px; border-radius: 16px; border: 1px solid var(--border); background: rgba(17, 24, 39, 0.6); backdrop-filter: blur(12px); box-shadow: var(--shadow); padding: 22px; }
      .auth-title { margin: 0 0 6px; font-size: 1.6rem; }
      .auth-sub { margin: 0 0 16px; color: var(--muted); }
      .btn.primary { box-shadow: 0 10px 25px rgba(108,140,255,.25); }
      .btn.primary:hover { transform: translateY(-1px); }
      .input.invalid { border-color: #ef4444 !important; box-shadow: 0 0 0 3px rgba(239,68,68,.2); }
      .input.valid { border-color: #10b981 !important; box-shadow: 0 0 0 3px rgba(16,185,129,.2); }
      .alert { padding: 12px; margin: 12px 0; border-radius: 8px; font-weight: 500;}
      .alert.error { background: #fee2e2; color: #dc2626; border: 1px solid #fecaca; }
      .spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid transparent; border-top: 2px solid currentColor; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 8px; }
      .btn-google { display: flex !important; align-items: center; justify-content: center; gap: 8px; width: 100%; }
      .auth-divider { margin: 20px 0; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.1);text-align: center;position: relative;}
      .auth-divider::before { content: 'or'; position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: rgba(17,24,39,0.8); padding: 0 16px; color: #9ca3af; font-size: 14px;}
      .form { display: flex; flex-direction: column; gap: 20px;  /* Perfect 20px between ALL form elements */}
      .flex-col { display: flex; flex-direction: column; gap: 6px;   /* Perfect space between label + input */}
      @keyframes spin { to { transform: rotate(360deg); } }

      @media (max-width: 480px) { .auth-card { margin: 0 8px; padding: 20px; } }
    </style>

    <div class="auth-wrap">
      <div class="anim-bg">
        <span class="orb o1"></span>
        <span class="orb o2"></span>
        <span class="orb o3"></span>
        <span class="orb o4"></span>
        <div id="lottie-login" style="position:absolute; inset:0; opacity:.35; pointer-events:none;"></div>
      </div>

      <div class="auth-card">
        <h2 class="auth-title">Welcome back</h2>
        <p class="auth-sub">Sign in to continue to CampusVibe</p>
        <div id="msg"></div>
        <form id="loginForm" novalidate>
          <div class="flex-col">
            <label class="label" for="email">Email Address</label>
            <input class="input" id="email" type="email" autocomplete="email username" placeholder="you@college.edu" required />
          </div>
          <div class="flex-col" style="margin-bottom: 20px;">
            <label class="label" for="password">Password</label>
            <input class="input" id="password" type="password" autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6" />
          </div>

          <button class="btn primary" type="submit" id="loginBtn">
            <span class="spinner" style="display:none;"></span>
            Sign In
          </button>
        </form>
        <div style="margin: 20px 0; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.1);">
          <a class="btn outline" href="#" id="googleBtn"> üåê Login with Google</a>
          <p class="muted" style="text-align: center; margin-top: 24px;">New user? <a href="/register.html">Register</a></p>
        </div>
      </div>
    </div>
</main>

  <script>
  const form = document.getElementById('loginForm');
  const msg = document.getElementById('msg');
  const emailEl = document.getElementById('email');
  const passEl = document.getElementById('password');
  const loginBtn = document.getElementById('loginBtn');
  const googleBtn = document.getElementById('googleBtn');

  // Lottie animation
  try {
    if (window.lottie) {
      window.lottie.loadAnimation({
        container: document.getElementById('lottie-login'),
        renderer: 'svg', loop: true, autoplay: true,
        path: '/assets/lottie/login.json'
      });
    }
  } catch (e) { console.warn('Lottie failed'); }

  // Form validation + submission
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    if (!validateForm()) return;
    
    setLoading(true);
    try {
      const email = emailEl.value.trim();
      const password = passEl.value;
      
      const res = await fetch('/api/auth/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        credentials: 'include',
        body: JSON.stringify({ email, password })
      });
      
      if (!res.ok) {
        const { message = 'Invalid credentials' } = await res.json().catch(() => ({}));
        showMessage(message, 'error');
        return;
      }
      
      // Success - redirect based on role
      const { user } = await res.json();
      location.href = user.role === 'committee' ? '/dashboard.html' : '/';
      
    } catch (error) {
      showMessage('Network error. Check connection.', 'error');
    } finally {
      setLoading(false);
    }
  });

  // Real-time validation
  [emailEl, passEl].forEach(el => {
    el.addEventListener('blur', () => validateField(el));
    el.addEventListener('input', () => clearFieldError(el));
  });

  // Google OAuth
  googleBtn?.addEventListener('click', (e) => {
    e.preventDefault();
    window.location.href = '/api/auth/google';
  });

  // Utility functions
  function validateForm() {
    let valid = true;
    [emailEl, passEl].forEach(el => valid = validateField(el) && valid);
    return valid;
  }

  function validateField(el) {
    el.classList.remove('invalid', 'valid');
    
    if (!el.value.trim()) {
      el.classList.add('invalid');
      return false;
    }
    
    if (el.id === 'email' && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(el.value)) {
      el.classList.add('invalid');
      return false;
    }
    
    if (el.id === 'password' && el.value.length < 6) {
      el.classList.add('invalid');
      return false;
    }
    
    el.classList.add('valid');
    return true;
  }

  function clearFieldError(el) {
    el.classList.remove('invalid');
  }

  function setLoading(loading) {
    loginBtn.disabled = loading;
    const spinner = loginBtn.querySelector('.spinner');
    loginBtn.querySelector('.btn-text')?.remove();
    
    if (loading) {
      spinner.style.display = 'inline-block';
      loginBtn.innerHTML = '<span class="spinner"></span>Signing in...';
    } else {
      spinner.style.display = 'none';
      loginBtn.textContent = 'Sign In';
    }
  }

  function showMessage(text, type = 'success') {
    msg.innerHTML = `<div class="alert ${type}">${text}</div>`;
    setTimeout(() => msg.innerHTML = '', 5000);
  }
</script>
</body>
</html>
